# 💬 聊天功能使用指南

## 🚀 功能概览

诺丁汉留学圈现已支持用户间私聊功能，让同学们可以更便捷地交流和分享经验。

## 📱 如何使用聊天功能

### 1. 发起聊天

有两种方式可以发起聊天：

#### 方式一：通过用户资料页面
1. 在首页点击任何帖子中的用户头像或姓名
2. 进入用户资料页面
3. 点击 "发起聊天" 按钮
4. 系统会自动创建或打开与该用户的聊天会话

#### 方式二：通过聊天页面
1. 点击导航栏的聊天图标 💬
2. 点击 "+" 按钮（即将上线）
3. 搜索并选择要聊天的用户

### 2. 查看聊天列表

1. 点击导航栏的聊天图标 💬
2. 查看所有聊天会话
3. 未读消息会显示红色数字角标
4. 点击任一会话进入聊天界面

### 3. 聊天界面功能

- **发送消息**：输入文本后按 Enter 或点击发送按钮
- **实时消息**：消息实时同步，无需刷新页面
- **在线状态**：查看对方是否在线
- **消息时间**：显示消息发送的相对时间
- **已读状态**：消息自动标记为已读

### 4. 移动端使用

- 底部导航栏包含聊天入口
- 响应式设计，完美适配手机屏幕
- 支持触摸操作

## 🔧 开发者工具

### 创建测试数据

如果需要测试聊天功能，可以运行：

```bash
node scripts/create-test-chat.js
```

这将创建：
- 3个测试用户（张小明、李小红、王小华）
- 2个测试聊天会话
- 5条测试消息
- 在线状态数据

### 清理测试数据

测试完成后，可以运行：

```bash
node scripts/cleanup-test-chat.js
```

这将删除所有测试相关的数据。

## 🛠 技术特性

### 实时通信
- 使用 Firestore 实时监听器
- 消息即时送达，无延迟
- 在线状态实时更新

### 数据结构
- **conversations**：聊天会话集合
- **messages**：消息集合
- **onlineStatus**：在线状态集合

### 安全性
- 基于 Firebase Auth 的用户认证
- Firestore 安全规则保护数据
- 只能查看参与的会话

### 性能优化
- 消息分页加载（默认50条）
- 实时监听器自动管理
- 内存优化和垃圾回收

## 🎯 使用技巧

1. **快速回复**：使用 Enter 键快速发送消息
2. **查看历史**：向上滚动查看更多历史消息
3. **在线状态**：绿色圆点表示用户在线
4. **未读提醒**：红色数字显示未读消息数量

## 🚨 问题排查

### 聊天页面一直加载

如果遇到加载问题：

1. 检查网络连接
2. 确认已登录
3. 等待10秒（系统有自动超时）
4. 刷新页面重试

### 消息发送失败

可能原因：
1. 网络连接问题
2. 权限不足
3. 会话不存在

### 无法看到其他用户

确保：
1. 双方都已注册
2. 通过正确的途径发起聊天
3. 检查用户资料页面是否可访问

## 📞 技术支持

如果遇到问题或有功能建议，请：

1. 检查浏览器控制台错误信息
2. 尝试刷新页面
3. 清除浏览器缓存
4. 联系开发团队

---

�� **祝你在诺丁汉留学圈玩得开心！** 