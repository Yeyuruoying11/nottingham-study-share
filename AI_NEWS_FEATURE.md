# AI新闻发送功能实现指南

## 🎯 功能概述

为诺丁汉大学学生分享平台的AI角色新增了自动新闻发送功能，AI可以定期获取和发布诺丁汉本地新闻、大学动态、天气信息和校园活动，为学生提供及时有用的资讯。

## ✨ 核心功能特性

### 📰 新闻来源
- **大学新闻**: 图书馆开放时间、课程系统更新、学生服务等
- **本地新闻**: 诺丁汉市政动态、交通信息、安全提醒等
- **天气信息**: 每日天气状况、温度、湿度、风速等
- **校园活动**: 学术讲座、文化活动、招聘会、开放日等

### ⚙️ 智能配置选项
- **发送频率**: 1-24小时可调节间隔
- **发送时间**: 自定义活跃时间段（如8:00-18:00）
- **内容来源**: 可选择性启用不同新闻源
- **发送限制**: 每日最大新闻发送数量控制
- **内容增强**: 可选包含天气和活动信息

### 🤖 AI智能处理
- **内容优化**: AI根据角色个性重新组织新闻内容
- **语言风格**: 保持角色一致的语调和表达方式
- **学生视角**: 突出与学生生活相关的信息
- **格式美化**: 自动添加emoji和结构化排版

## 🛠️ 技术实现

### 1. 类型扩展 (`lib/types.ts`)
```typescript
// AI角色配置中新增news_posting设置
news_posting: {
  enabled: boolean;
  interval_hours: number;
  max_news_per_day: number;
  news_sources: ('local' | 'university' | 'weather' | 'events')[];
  post_time_range: {
    start: number;
    end: number;
  };
  include_weather: boolean;
  include_events: boolean;
}
```

### 2. 新闻服务 (`lib/news-service.ts`)
核心服务类，负责获取和处理各类新闻信息：

```typescript
export class NewsService {
  // 获取本地新闻
  static async getLocalNews(): Promise<NewsItem[]>
  
  // 获取大学新闻  
  static async getUniversityNews(): Promise<NewsItem[]>
  
  // 获取天气信息
  static async getWeatherInfo(): Promise<WeatherInfo | null>
  
  // 获取校园活动
  static async getCampusEvents(): Promise<CampusEvent[]>
  
  // 获取综合新闻摘要
  static async getNewsDigest(): Promise<{...}>
  
  // 格式化新闻内容
  static formatNewsContent(): string
}
```

### 3. AI发帖服务增强 (`lib/ai-posting-service.ts`)
扩展现有发帖服务，支持新闻类型帖子：

```typescript
// 新增方法
static async generateNewsPost(character: AICharacter): Promise<AIGeneratedPost>
static async checkDailyNewsPostLimit(characterId: string, maxNewsPerDay: number): Promise<boolean>
static isInNewsPostTimeRange(timeRange: { start: number; end: number }): boolean
```

### 4. 配置界面增强 (`components/admin/AIConfigManager.tsx`)
- 新增"新闻发送"标签页
- 完整的新闻配置选项
- 立即发送新闻按钮
- 新闻发送状态显示

## 📱 用户界面

### 管理员配置界面
```
┌─────────────────────────────────────┐
│ AI配置管理                           │
├─────────────────────────────────────┤
│ [基本信息] [个性设置] [聊天配置]       │
│ [发帖设置] [新闻发送] [用户档案] ←新增 │
├─────────────────────────────────────┤
│ 新闻发送设置                         │
│ ☑️ 启用新闻发送功能                   │
│                                     │
│ 发送间隔: [每8小时 ▼]                │
│ 最大数量: [2] 条/天                  │
│                                     │
│ 发送时间: [08:00 ▼] 到 [18:00 ▼]    │
│                                     │
│ 新闻来源:                           │
│ ☑️ 大学新闻  ☑️ 本地新闻              │
│ ☑️ 天气信息  ☑️ 校园活动              │
│                                     │
│ 其他选项:                           │
│ ☑️ 包含天气信息                      │
│ ☑️ 包含校园活动                      │
└─────────────────────────────────────┘
```

### AI角色卡片
```
┌─────────────────────────────────┐
│ 📱 小AI助手              [👁️]    │
│ @xiaoli_helper                  │
│ ai@nottingham.edu               │
├─────────────────────────────────┤
│ AI模型: DeepSeek               │
│ 聊天回复: 开启                  │
│ 自动发帖: 每4小时              │
│ 新闻发送: 每8小时 ←新增         │
├─────────────────────────────────┤
│ [编辑] [发帖] [新闻] [🗑️] ←新增  │
└─────────────────────────────────┘
```

## 🎨 生成内容示例

### 新闻帖子样例
```
📰 今日诺丁汉资讯速递

🌤️ **今日天气**
诺丁汉: 16°C, 多云
天空多云，温度适宜
湿度: 65%, 风速: 8km/h

📰 **今日要闻**

1. **诺丁汉大学图书馆延长开放时间**
为满足学生期末复习需求，主图书馆将在考试期间延长开放时间至凌晨2点，并增加自习座位。
来源: 诺丁汉大学

2. **诺丁汉公交系统推出学生优惠政策**
从本月起，诺丁汉公交系统为所有在校学生提供额外的票价优惠，学生可享受单程票8折优惠。
来源: 诺丁汉交通局

🎯 **今日校园活动**

• **学术研讨会：人工智能前沿技术**
  📍 工程学院大楼A301
  计算机科学系举办的AI技术研讨会，欢迎所有对人工智能感兴趣的学生参加。

📅 **近期活动预告**

• **国际文化节**
  📅 12月20日 星期五
  📍 学生活动中心
  展示世界各国文化的盛大活动，包括美食、音乐和传统表演。
```

## 🔧 配置说明

### 基础配置
1. **启用功能**: 勾选"启用新闻发送功能"
2. **发送频率**: 建议8-12小时，避免信息过载
3. **每日限制**: 建议1-3条，保证内容质量
4. **活跃时间**: 建议8:00-18:00，工作时间内发送

### 新闻来源选择
- **大学新闻**: 适合学术型AI角色
- **本地新闻**: 适合生活助手型AI
- **天气信息**: 实用性强，建议启用
- **校园活动**: 促进学生参与，建议启用

### 高级配置
- **AI个性化**: 新闻内容会根据AI角色的语调和风格进行调整
- **智能筛选**: 自动过滤与学生生活相关度低的信息
- **时间智能**: 避免在深夜或过早时间发送

## 🚀 使用指南

### 创建新闻AI角色
1. 进入管理员面板 → AI配置管理
2. 点击"创建AI角色"
3. 填写基本信息，建议取名如"新闻小助手"、"校园速递"等
4. 在"新闻发送"标签页中启用并配置相关选项
5. 保存配置

### 立即测试新闻发送
1. 在AI角色卡片中点击"新闻"按钮
2. 系统会立即生成并发布一条新闻帖子
3. 查看首页验证新闻内容格式和质量

### 自动化配置
- 系统会根据设定的间隔自动发送新闻
- 在配置的时间范围内执行
- 不会超过每日最大发送数量限制

## 📊 监控和统计

### AI角色统计面板
- **总发帖数**: 包含新闻帖子
- **今日发帖数**: 区分普通帖子和新闻帖子
- **新闻发送状态**: 显示是否启用及频率
- **最后发送时间**: 便于监控发送状态

### 内容质量控制
- **重复检测**: 避免发送重复新闻
- **时效性检查**: 确保新闻内容的时效性
- **相关性过滤**: 自动筛选与学生相关的内容

## 🔮 未来扩展计划

### 功能增强
1. **真实API接入**: 连接真实的新闻API和天气API
2. **个性化推荐**: 根据用户兴趣推送相关新闻
3. **多语言支持**: 支持中英文双语新闻
4. **图片集成**: 为新闻添加相关图片

### 智能优化
1. **用户反馈学习**: 根据点赞和评论优化内容
2. **发送时机优化**: 分析最佳发送时间
3. **内容去重**: 更智能的重复内容检测
4. **分类推送**: 不同用户群体推送不同类型新闻

## 🔒 注意事项

### 内容责任
- 当前使用模拟数据，实际部署需要可靠的新闻源
- 需要建立内容审核机制
- 确保新闻内容的准确性和适当性

### 性能考虑
- 新闻获取可能需要网络请求，建议设置合理的超时时间
- 考虑缓存机制减少重复请求
- 监控API调用频率避免超出限制

### 用户体验
- 避免信息过载，控制发送频率
- 确保新闻内容与学生生活相关
- 提供用户取消订阅的选项

---

**实现状态**: ✅ 已完成并测试  
**测试环境**: 本地开发环境  
**部署建议**: 建议先在测试环境验证后再部署到生产环境 