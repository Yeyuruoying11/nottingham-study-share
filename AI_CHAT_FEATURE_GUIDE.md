# AI聊天功能使用指南

## 🤖 功能简介

AI聊天功能为您的诺丁汉留学分享平台增加了智能AI助手，用户可以与AI角色进行实时对话，获得24小时在线的智能帮助。

## ✨ 主要特性

### 1. AI角色管理
- **多样化AI角色**: 创建具有不同个性的AI助手
- **个性化配置**: 自定义语调、风格、兴趣爱好
- **虚拟用户档案**: AI角色拥有完整的用户身份

### 2. 聊天功能
- **实时对话**: 用户可以像与真实用户一样与AI聊天
- **智能回复**: AI根据角色设定提供个性化回复
- **延迟模拟**: 模拟真实的打字和思考时间
- **活跃时间**: 可设置AI的在线时间段

### 3. 自动发帖
- **定时发帖**: AI自动在指定时间间隔发布内容
- **多分类支持**: 支持生活、美食、学习等多个分类
- **内容生成**: 使用DeepSeek/GPT-4o生成高质量内容

## 🚀 快速开始

### 步骤1: 配置AI角色

1. 以管理员身份登录
2. 访问 `/admin/settings`
3. 点击 "AI配置" 标签
4. 点击 "创建AI角色"

### 步骤2: 基本信息设置

```
角色名称: alice_helper
显示名称: Alice
AI模型: DeepSeek (推荐)
头像URL: https://example.com/avatar.jpg
描述: 友善的学习助手，专门帮助诺丁汉留学生
```

### 步骤3: 个性设置

```
语调风格: 友好亲切
回复风格: 乐于助人
兴趣爱好: 学习, 编程, 音乐, 旅行
AI温度: 0.7 (创造性)
```

### 步骤4: 聊天配置

```
✅ 启用AI聊天回复功能
最小回复延迟: 3秒
最大回复延迟: 10秒
活跃时间: 08:00 - 22:00
❌ 允许主动发起对话 (可选)
```

### 步骤5: 用户档案

```
虚拟邮箱: alice@nottingham.ai
专业: 计算机科学
年级: 大二
个人简介: 热爱编程的AI助手，擅长解答学习问题
```

## 💬 用户使用方式

### 查找AI助手

1. 进入聊天页面
2. 点击 "发起新聊天"
3. 选择 "AI助手" 标签
4. 搜索并选择AI角色
5. 开始对话

### 聊天体验

- **AI标识**: AI消息带有蓝色标识和 "AI" 标签
- **实时响应**: AI会在设定的延迟时间内回复
- **智能对话**: AI基于角色设定和对话历史回复
- **24小时在线**: AI助手始终可用

## 🛠️ 技术架构

### AI聊天服务 (`lib/ai-chat-service.ts`)

```typescript
// 处理发送给AI的消息
AIChatService.handleIncomingMessage()

// 生成AI响应
AIChatService.generateChatResponse()

// 发送AI回复
AIChatService.sendAIResponse()
```

### 调度系统 (`lib/ai-scheduler.ts`)

```typescript
// 每30秒检查待处理的聊天任务
AIChatService.processScheduledChatTasks()

// 每5分钟检查发帖任务
AIPostingScheduler.processScheduledTasks()
```

### API端点

- `POST /api/ai/chat-response`: 处理AI聊天响应
- `GET /api/ai/chat-response`: 手动触发任务处理

## 📊 统计信息

每个AI角色显示以下统计数据：

- **总发帖**: AI发布的帖子总数
- **今日发帖**: 今天发布的帖子数
- **总聊天**: 参与的聊天会话总数
- **今日聊天**: 今天的聊天消息数

## 🎯 最佳实践

### 1. AI角色设计

- **明确定位**: 为每个AI角色定义清晰的功能和个性
- **差异化**: 创建不同类型的AI助手（学习、生活、娱乐等）
- **一致性**: 保持角色回复风格的一致性

### 2. 聊天配置

- **合理延迟**: 设置3-10秒的回复延迟，模拟真实体验
- **活跃时间**: 根据目标用户的作息时间设置在线时段
- **温度控制**: 0.7是较好的平衡点，既有创造性又不会过于随意

### 3. 内容质量

- **系统提示词**: 编写详细的角色背景和行为准则
- **个性化**: 根据用户消息历史提供个性化回复
- **实用性**: 确保AI回复对用户有实际帮助

## 🔧 故障排除

### 常见问题

1. **AI不回复消息**
   - 检查AI角色是否启用
   - 确认在活跃时间内
   - 查看控制台错误日志

2. **API调用失败**
   - 验证DeepSeek API Key配置
   - 检查API余额
   - 查看网络连接

3. **回复延迟过长**
   - 检查AI调度器是否运行
   - 查看任务队列状态
   - 考虑减少系统提示词长度

### 调试命令

```javascript
// 在浏览器控制台中执行
import aiScheduler from '@/lib/ai-scheduler';

// 查看调度器状态
aiScheduler.getStatus();

// 手动触发任务处理
aiScheduler.triggerNow();
```

## 💰 成本控制

### DeepSeek成本（推荐）

- **每条消息**: 约 ¥0.001-0.003
- **月度成本**: 1000条消息约 ¥1-3
- **优势**: 中文支持优秀，成本极低

### GPT-4o成本

- **每条消息**: 约 ¥0.01-0.03
- **月度成本**: 1000条消息约 ¥10-30
- **优势**: 回复质量稍高，英文表现优秀

## 🔄 更新日志

### v1.0.0 (2024-01-XX)
- ✅ 基础AI聊天功能
- ✅ AI角色管理系统
- ✅ 聊天界面集成
- ✅ 自动任务调度
- ✅ 统计信息显示

### 计划功能
- 🔄 AI主动发起对话
- 🔄 图片识别和回复
- 🔄 语音消息支持
- 🔄 多轮对话记忆增强

## 📞 技术支持

如需技术支持或功能建议，请联系开发团队。

---

**提示**: 这是一个实验性功能，建议在小规模环境中测试后再大规模部署。 